# 读书笔记

## 想法理解

### 书籍

《Elastic search 权威指南》

## 收获

Problem：如何处理海量文档类数据（搜索、更新、统计）？

A method ：**Elastic search ** 全文搜索引擎

Characteristics 特点：

**实现全文搜索**，且**高可用**（故障恢复，不易丢失数据、选举算法）、**高性能**（速度快、高并发）、**高可扩展性**（自动负载均衡）

1. **面向文档类型数据**（非结构化数据）。存储整个文档或者对象-JSON格式。
2. **分布式部署**。集群式，多节点，多副本（高可用、高性能）。
3. **自动负载均衡**。扩展节点和副本数时，自动均衡负载（高可扩展性）
4. **RESTful API** 。RESTful的HTTP接口设计。

Description  功能：

1. 更新（update、create）。局部更新、批量更新bulk-

   { action: { metadata }}**\n**
   { request body }\n
   { action: { metadata }}\n
   { request body }\n

2. 搜索（search）

3. 统计（aggregation）

4. 是否存在（HEAD）

集群健康：

- **green**。所有的**主分片**和**主分片下设置数量的分片副本**都可用。
- **yellow**。所有的**主分片可用**，但是**可用副本数量不够**（存在不可用的副本）。
- **red**。可用**主分片数量不足**。

此外还有：

- **容错转移**。节点宕机，数据不会丢失。**选举新的主节点**，并在其他节点上**选举新的主分片**。
- **扩展**。**主分片数量不可变**，副本数量可变。新增节点或者增大副本数量后。es可**自动负载均衡**（主分片和副本不能在同一个节点上，最大有效节点数=主副分片总数）。
- **并发控制**。ES采用乐观并发锁，使用**文档版本号“_version”**，标记更改，**更新、创建、删除**操作都会导致version的增大。**如果旧版本操作出现在新版本操作之后，将会被忽略，并提示冲突错误。可以自定义程序之后的行为，比如重试一定次数.**

